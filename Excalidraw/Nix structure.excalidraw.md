---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠==


# Text Elements
Nix packages are stored in unique locations in Nix store ^LwN5KgPM

To run packages, we need the hashed dirs in our path,
Instead, Nix creates symlinks to activated packages
in the user environments  ^IcYPotu3

packages installed with nix-env ^cHS56jG3

Now we would need to have hashed user-env in our path
Instead symlinks to user-env is created by generations ^T1kGigwa

generated by nix-env everytime the command is run
based on previous generation ^C04LjdfW

These generations are stored under profiles
sp that different users using different generations
don't interfere with each other  ^aTcVwDYd

default profile is symlink to current generation
every time nix-env operation is performed,
new generation and user environment is created based on current one,
and default profile is updated to symlink to this new generation.
This way, we can rollback between generations and also switch to specific generations
 ^uywlE8LT

Now we need profiles/default/bin in our path,
which is done by symlinking some profile to ~/.nix-profile ^Rh5yfXJh

This allows us to switch generations ^H3XJjR4i

the nix.sh script finally adds ~/.nix-profile/bin to $PATH
We only need to source /nix/etc/profile.d/nix.sh in .bashrc or .zshrc ^hXvBmzBU

This allows us to switch profiles ^uUqt4DCw


# Embedded files
f68c203f025ff900b45c8ee9837321131a30ae3b: [[Pasted Image 20230728121606_544.png]]

%%
# Drawing
```json
{
	"type": "excalidraw",
	"version": 2,
	"source": "https://github.com/zsviczian/obsidian-excalidraw-plugin/releases/tag/1.9.12",
	"elements": [
		{
			"type": "image",
			"version": 127,
			"versionNonce": 481176600,
			"isDeleted": false,
			"id": "Arp1Qz46-N93RZxA_0xIs",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -430.5,
			"y": -328.7421875,
			"strokeColor": "transparent",
			"backgroundColor": "transparent",
			"width": 741,
			"height": 429,
			"seed": 1132167528,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690526765087,
			"link": null,
			"locked": false,
			"status": "pending",
			"fileId": "f68c203f025ff900b45c8ee9837321131a30ae3b",
			"scale": [
				1,
				1
			]
		},
		{
			"type": "text",
			"version": 136,
			"versionNonce": 1051211800,
			"isDeleted": false,
			"id": "LwN5KgPM",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -419.0000000000001,
			"y": 137.29253472222229,
			"strokeColor": "#1e1e1e",
			"backgroundColor": "transparent",
			"width": 557.3795166015625,
			"height": 25,
			"seed": 1128327448,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "Nix packages are stored in unique locations in Nix store",
			"rawText": "Nix packages are stored in unique locations in Nix store",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "Nix packages are stored in unique locations in Nix store",
			"lineHeight": 1.25,
			"baseline": 18
		},
		{
			"type": "text",
			"version": 256,
			"versionNonce": 153679208,
			"isDeleted": false,
			"id": "IcYPotu3",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -401.2222222222224,
			"y": 221.73697916666663,
			"strokeColor": "#1e1e1e",
			"backgroundColor": "transparent",
			"width": 543.3595581054688,
			"height": 75,
			"seed": 1351921000,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "To run packages, we need the hashed dirs in our path,\nInstead, Nix creates symlinks to activated packages\nin the user environments ",
			"rawText": "To run packages, we need the hashed dirs in our path,\nInstead, Nix creates symlinks to activated packages\nin the user environments ",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "To run packages, we need the hashed dirs in our path,\nInstead, Nix creates symlinks to activated packages\nin the user environments ",
			"lineHeight": 1.25,
			"baseline": 68
		},
		{
			"type": "text",
			"version": 170,
			"versionNonce": 840529176,
			"isDeleted": false,
			"id": "cHS56jG3",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -95.66666666666674,
			"y": 281.73697916666663,
			"strokeColor": "#1971c2",
			"backgroundColor": "transparent",
			"width": 301.8597412109375,
			"height": 25,
			"seed": 1242694424,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "packages installed with nix-env",
			"rawText": "packages installed with nix-env",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "packages installed with nix-env",
			"lineHeight": 1.25,
			"baseline": 18
		},
		{
			"type": "line",
			"version": 97,
			"versionNonce": 775293032,
			"isDeleted": false,
			"id": "wunMPLifUeEE6iqphTGR-",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 127.66666666666652,
			"y": 279.51475694444434,
			"strokeColor": "#1971c2",
			"backgroundColor": "transparent",
			"width": 189.99999999999997,
			"height": 0,
			"seed": 685837080,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					-189.99999999999997,
					0
				]
			]
		},
		{
			"type": "text",
			"version": 245,
			"versionNonce": 2119897624,
			"isDeleted": false,
			"id": "T1kGigwa",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -405.66666666666674,
			"y": 356.181423611111,
			"strokeColor": "#1e1e1e",
			"backgroundColor": "transparent",
			"width": 556.2595825195312,
			"height": 50,
			"seed": 429037080,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "Now we would need to have hashed user-env in our path\nInstead symlinks to user-env is created by generations",
			"rawText": "Now we would need to have hashed user-env in our path\nInstead symlinks to user-env is created by generations",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "Now we would need to have hashed user-env in our path\nInstead symlinks to user-env is created by generations",
			"lineHeight": 1.25,
			"baseline": 43
		},
		{
			"type": "text",
			"version": 305,
			"versionNonce": 1982380904,
			"isDeleted": false,
			"id": "C04LjdfW",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -122.26320393880218,
			"y": 417.01475694444423,
			"strokeColor": "#1971c2",
			"backgroundColor": "transparent",
			"width": 497.01959228515625,
			"height": 50,
			"seed": 153960984,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "generated by nix-env everytime the command is run\nbased on previous generation",
			"rawText": "generated by nix-env everytime the command is run\nbased on previous generation",
			"textAlign": "center",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "generated by nix-env everytime the command is run\nbased on previous generation",
			"lineHeight": 1.25,
			"baseline": 43
		},
		{
			"type": "line",
			"version": 163,
			"versionNonce": 1784745752,
			"isDeleted": false,
			"id": "Ay3dbIbSGKyld8U3l49v2",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -7.888888888888971,
			"y": 413.9592013888887,
			"strokeColor": "#1971c2",
			"backgroundColor": "transparent",
			"width": 178.8888888888889,
			"height": 1.1111111111110858,
			"seed": 1645093992,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					178.8888888888889,
					-1.1111111111110858
				]
			]
		},
		{
			"type": "ellipse",
			"version": 170,
			"versionNonce": 860687976,
			"isDeleted": false,
			"id": "bhJWF5ZUer9d9ssca1QMp",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -337.8888888888889,
			"y": 266.1814236111107,
			"strokeColor": "#2f9e44",
			"backgroundColor": "transparent",
			"width": 186.66666666666666,
			"height": 45.55555555555554,
			"seed": 399176552,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false
		},
		{
			"type": "ellipse",
			"version": 181,
			"versionNonce": 1050635288,
			"isDeleted": false,
			"id": "MYCpEST2eEzzKXSRZA7Mr",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 22.111111111111086,
			"y": 375.0703124999997,
			"strokeColor": "#2f9e44",
			"backgroundColor": "transparent",
			"width": 125.55555555555556,
			"height": 44.444444444444464,
			"seed": 300704360,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529397205,
			"link": null,
			"locked": false
		},
		{
			"type": "text",
			"version": 147,
			"versionNonce": 1457159448,
			"isDeleted": false,
			"id": "aTcVwDYd",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -366.72751532660584,
			"y": 511.0703124999996,
			"strokeColor": "#1e1e1e",
			"backgroundColor": "transparent",
			"width": 507.89947509765625,
			"height": 75,
			"seed": 1958250856,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690528011163,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "These generations are stored under profiles\nsp that different users using different generations\ndon't interfere with each other ",
			"rawText": "These generations are stored under profiles\nsp that different users using different generations\ndon't interfere with each other ",
			"textAlign": "center",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "These generations are stored under profiles\nsp that different users using different generations\ndon't interfere with each other ",
			"lineHeight": 1.25,
			"baseline": 68
		},
		{
			"type": "text",
			"version": 350,
			"versionNonce": 454392344,
			"isDeleted": false,
			"id": "uywlE8LT",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -553.2522989908855,
			"y": 604.625868055555,
			"strokeColor": "#2f9e44",
			"backgroundColor": "transparent",
			"width": 1193.471435546875,
			"height": 210,
			"seed": 1975196184,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529403788,
			"link": null,
			"locked": false,
			"fontSize": 28,
			"fontFamily": 1,
			"text": "default profile is symlink to current generation\nevery time nix-env operation is performed,\nnew generation and user environment is created based on current one,\nand default profile is updated to symlink to this new generation.\nThis way, we can rollback between generations and also switch to specific generations\n",
			"rawText": "default profile is symlink to current generation\nevery time nix-env operation is performed,\nnew generation and user environment is created based on current one,\nand default profile is updated to symlink to this new generation.\nThis way, we can rollback between generations and also switch to specific generations\n",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "default profile is symlink to current generation\nevery time nix-env operation is performed,\nnew generation and user environment is created based on current one,\nand default profile is updated to symlink to this new generation.\nThis way, we can rollback between generations and also switch to specific generations\n",
			"lineHeight": 1.25,
			"baseline": 200
		},
		{
			"type": "text",
			"version": 287,
			"versionNonce": 759311720,
			"isDeleted": false,
			"id": "Rh5yfXJh",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -463.8982259570497,
			"y": 817.746316234827,
			"strokeColor": "#2f9e44",
			"backgroundColor": "transparent",
			"width": 759.24755859375,
			"height": 70,
			"seed": 582486552,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529325989,
			"link": null,
			"locked": false,
			"fontSize": 28,
			"fontFamily": 1,
			"text": "Now we need profiles/default/bin in our path,\nwhich is done by symlinking some profile to ~/.nix-profile",
			"rawText": "Now we need profiles/default/bin in our path,\nwhich is done by symlinking some profile to ~/.nix-profile",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "Now we need profiles/default/bin in our path,\nwhich is done by symlinking some profile to ~/.nix-profile",
			"lineHeight": 1.25,
			"baseline": 60
		},
		{
			"type": "ellipse",
			"version": 222,
			"versionNonce": 1937080424,
			"isDeleted": false,
			"id": "8aptn_UhTCQ4Rj4n-NdFK",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -556.1839402427639,
			"y": 588.1748876633982,
			"strokeColor": "#e03131",
			"backgroundColor": "transparent",
			"width": 211.4285714285715,
			"height": 64.28571428571433,
			"seed": 199287400,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529418986,
			"link": null,
			"locked": false
		},
		{
			"type": "text",
			"version": 116,
			"versionNonce": 15946856,
			"isDeleted": false,
			"id": "H3XJjR4i",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 69.53034547152185,
			"y": 637.8891733776841,
			"strokeColor": "#e03131",
			"backgroundColor": "transparent",
			"width": 362.5596923828125,
			"height": 25,
			"seed": 407751016,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529426271,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "This allows us to switch generations",
			"rawText": "This allows us to switch generations",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "This allows us to switch generations",
			"lineHeight": 1.25,
			"baseline": 18
		},
		{
			"type": "line",
			"version": 108,
			"versionNonce": 1006679656,
			"isDeleted": false,
			"id": "58A1EEQ4BlDeA6W84pvho",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -300.7553688141924,
			"y": 640.6034590919697,
			"strokeColor": "#e03131",
			"backgroundColor": "transparent",
			"width": 454.2857142857144,
			"height": 4.285714285714334,
			"seed": 1845220456,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529423182,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					454.2857142857144,
					-4.285714285714334
				]
			]
		},
		{
			"type": "text",
			"version": 158,
			"versionNonce": 525025560,
			"isDeleted": false,
			"id": "hXvBmzBU",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": -393.8982259570497,
			"y": 923.460601949113,
			"strokeColor": "#1971c2",
			"backgroundColor": "transparent",
			"width": 661.9594116210938,
			"height": 50,
			"seed": 2049919336,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529341902,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "the nix.sh script finally adds ~/.nix-profile/bin to $PATH\nWe only need to source /nix/etc/profile.d/nix.sh in .bashrc or .zshrc",
			"rawText": "the nix.sh script finally adds ~/.nix-profile/bin to $PATH\nWe only need to source /nix/etc/profile.d/nix.sh in .bashrc or .zshrc",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "the nix.sh script finally adds ~/.nix-profile/bin to $PATH\nWe only need to source /nix/etc/profile.d/nix.sh in .bashrc or .zshrc",
			"lineHeight": 1.25,
			"baseline": 43
		},
		{
			"type": "text",
			"version": 58,
			"versionNonce": 1438849304,
			"isDeleted": false,
			"id": "uUqt4DCw",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 230.38748832866486,
			"y": 887.7463162348272,
			"strokeColor": "#e03131",
			"backgroundColor": "transparent",
			"width": 323.11968994140625,
			"height": 25,
			"seed": 780873576,
			"groupIds": [],
			"frameId": null,
			"roundness": null,
			"boundElements": [],
			"updated": 1690529376436,
			"link": null,
			"locked": false,
			"fontSize": 20,
			"fontFamily": 1,
			"text": "This allows us to switch profiles",
			"rawText": "This allows us to switch profiles",
			"textAlign": "left",
			"verticalAlign": "top",
			"containerId": null,
			"originalText": "This allows us to switch profiles",
			"lineHeight": 1.25,
			"baseline": 18
		},
		{
			"type": "line",
			"version": 47,
			"versionNonce": 1160787480,
			"isDeleted": false,
			"id": "6-6YzOd_FemoBYlNYLNnW",
			"fillStyle": "hachure",
			"strokeWidth": 1,
			"strokeStyle": "solid",
			"roughness": 1,
			"opacity": 100,
			"angle": 0,
			"x": 288.9589169000934,
			"y": 886.3177448062556,
			"strokeColor": "#e03131",
			"backgroundColor": "transparent",
			"width": 504.28571428571433,
			"height": 5.714285714285552,
			"seed": 1462204264,
			"groupIds": [],
			"frameId": null,
			"roundness": {
				"type": 2
			},
			"boundElements": [],
			"updated": 1690529379392,
			"link": null,
			"locked": false,
			"startBinding": null,
			"endBinding": null,
			"lastCommittedPoint": null,
			"startArrowhead": null,
			"endArrowhead": null,
			"points": [
				[
					0,
					0
				],
				[
					-504.28571428571433,
					5.714285714285552
				]
			]
		}
	],
	"appState": {
		"theme": "dark",
		"viewBackgroundColor": "#ffffff",
		"currentItemStrokeColor": "#e03131",
		"currentItemBackgroundColor": "transparent",
		"currentItemFillStyle": "hachure",
		"currentItemStrokeWidth": 1,
		"currentItemStrokeStyle": "solid",
		"currentItemRoughness": 1,
		"currentItemOpacity": 100,
		"currentItemFontFamily": 1,
		"currentItemFontSize": 20,
		"currentItemTextAlign": "left",
		"currentItemStartArrowhead": null,
		"currentItemEndArrowhead": "arrow",
		"scrollX": 1399.5208633818486,
		"scrollY": 411.11435046775114,
		"zoom": {
			"value": 0.65
		},
		"currentItemRoundness": "round",
		"gridSize": null,
		"currentStrokeOptions": null,
		"previousGridSize": null,
		"frameRendering": {
			"enabled": true,
			"clip": true,
			"name": true,
			"outline": true
		}
	},
	"files": {}
}
```
%%